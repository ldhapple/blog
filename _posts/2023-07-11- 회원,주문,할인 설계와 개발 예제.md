---
title: 회원,주문,할인 설계와 개발 예제
author: leedohyun
date: 2023-07-12 22:13:00 -0500
categories: [JAVA, 스프링부트 기본]
tags: [java, Spring, SpringBoot]
---

우선 스프링의 편리함을 알기 위해 순수 자바코드를 통한 예제를 작성.

Dependencies에 아무것도 추가하지 않음. (Spring Web, Thymeleaf 등등)

## 비즈니스 요구사항 & 설계

- 회원
	- 회원을 가입하고 조회할 수 있다.
	- 회원은 일반과 VIP 두 가지 등급이 있다.
	- 회원 데이터는 자체 DB를 구축할 수 있고, 외부 시스템과 연동할 수 있다.(미정)

- 주문과 할인 정책
	- 회원은 상품을 주문할 수 있다.
	- 회원 등급에 따라 할인 정책을 적용할 수 있다.
	- 할인 정책은 모든 VIP는 1000원을 할인해주는 고정 금액 할인을 적용(추후 변경 가능성)
	- 할인 정책은 변경 가능성이 높다. 회사의 기본 할인 정책을 아직 정하지 못했고, 오픈 직전까지 고민을 미루고 싶다. 최악의 경우 할인을 적용하지 않을 수 있다. (미확정)

미확정이 된 부분들을 잘 파악하고 인터페이스를 만들고 구현체를 언제든 갈아끼울 수 있도록 설계해보자.

## 회원 도메인 설계


회원 데이터는 자체 DB or 외부 시스템과의 연동 중 미정이기 때문에 회원 데이터에 접근하는 계층을 따로 만들어준다.

회원 저장소 인터페이스를 만들고 메모리 회원저장소, DB 회원저장소, 외부시스템 연동 회원저장소를 구현체로 만들면 된다.

![](https://blog.kakaocdn.net/dn/1Cyx0/btsnnfu1Mon/c6WF2goXhlYyJkXHykiCz0/img.png) 

기획자도 볼 수 있는 수준의 협력관계

![](https://blog.kakaocdn.net/dn/pUDiO/btsnnT6fNVY/ciawAVcXfAfSXlx1y98gFk/img.png)

위의 협력관계를 바탕으로 개발자가 만든 클래스 다이어그램. MemoryMemberRepo 같은 경우 언제 얘를 불러올지 모름. DbMember을 부를지도 모르기 때문에 아래의 다이어그램을 작성하게 됨.

![](https://blog.kakaocdn.net/dn/RGzDD/btsnomfM2Tv/7nAQ88bOrX7upL8f9JYMH1/img.png)

클라이언트는 MemberServiceImpl에 접근하게 되고 그 MemberServiceImpl은 멤버 리포지토리에 접근해 데이터를 얻는다.

## 회원 도메인 개발

Alt + Insert로 Getter, Setter, 생성자 자동 삽입 가능.

Member/Member
Member/MemberRepository
Member/Grade -> 등급
Member/MemoryMemberRepository
Member/MemberService
Member/MemberServiceImpl

구현.

코드 참고 - ppt파일

## 회원 도메인 실행 & 테스트

core/MemberApp

main 함수를 따로 만들어주었음.

![](https://blog.kakaocdn.net/dn/cW6sqp/btsnkNd28J1/ITjtAKqkD5kt6wYt6qAZEK/img.png)

이렇게 실행해서 확인하는 방법은 비효율적임.

![](https://blog.kakaocdn.net/dn/C6r1l/btsnjcd5kgj/YfWBFWkgcGr8sJTyvBLkAk/img.png)

테스트 코드를 작성하는게 바람직 함.

given - 무엇이 주어졌을 때

when - 어떠한 상황에서

then - given과 when의 결과가 맞는지.

이러한 코드는 DIP 잘 지키지 못함.

```
private final MemberRepository memberRepository = new MemoryMemberRepository();
```

직접 선언함으로써 구현체에 의존하고 있음.

## 주문과 할인 도메인 설계

![](https://blog.kakaocdn.net/dn/wLG0A/btsnnUYrTDr/nj8zTBMB2Iu4JkSAxwwR60/img.png)

1. 클라이언트는 주문을 생성한다.
2. 할인을 위해서는 회원등급이 필요하다. 그래서 주문서비스는 회원 저장소에서 회원을 조회해야 한다.
3. 주문서비스는 회원 등급에 따라 할인 여부를 할인 정책에 위임한다.
4. 주문 서비스는 할인 결과를 포함한 주문 결과를 반환한다.

** 실제로는 주문 데이터를 DB에 저장하겠지만 일단 예제이므로 단순히 주문 결과를 반환한다.

![](https://blog.kakaocdn.net/dn/GrsTj/btsnpF6L2zP/jICRUUXuS8lnH0q9UKkUl1/img.png)

![](https://blog.kakaocdn.net/dn/dNpHEr/btsnoHDTrqT/XfnadmI3AI0RHY33KkbNy1/img.png)

- 할인

```
public interface DiscountPolicy {  
  
	//@return이 할인 대상 금액  
	int discount(Member member, int price);  
}
```

```
public class FixDiscountPolicy implements DiscountPolicy{  
  
	private int discountFixAmount = 1000;
	
	@Override  
	public int discount(Member member, int price) {  
		if(member.getGrade() == Grade.VIP){  
			return discountFixAmount;  
		}else{  
			return 0;  
		}  
	}  
}
```

- 주문

```
public class Order {  
  
	private Long memberId;  
	private String itemName;  
	private int itemPrice;  
	private int discountPrice;

	//생성자 및 getter, setter..

	public int calculatePrice(){
		return itemPrice - discountPrice;
	}
}
```

```
public interface OrderService {  
	Order createOrder(Long memberId, String itemName, int itemPrice);  
}
```

```
public class OrderServiceImpl implements OrderService{  
  
	private final MemberRepository memberRepository = new MemoryMemberRepository();  
	private final DiscountPolicy discountPolicy = new FixDiscountPolicy(); 
	 
	@Override  
	public Order createOrder(Long memberId, String itemName, int itemPrice) {  
		Member member = memberRepository.findById(memberId);  
		int discountPrice = discountPolicy.discount(member, itemPrice);  
  
		return new Order(memberId, itemName, itemPrice, discountPrice);  
	}  
}
```

## 주문 할인 도메인 실행 & 테스트

![](https://blog.kakaocdn.net/dn/z3L6X/btsnoDBDNsQ/EzGypNjiqtiAwllgZIxDF1/img.png)