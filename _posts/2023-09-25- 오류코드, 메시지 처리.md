---
title: 오류코드, 메시지 처리
author: leedohyun
date: 2023-09-25 20:13:00 -0500
categories: [Spring, 스프링 MVC 활용]
tags: [java, Spring, SpringBoot]
---

## 오류 코드와 메시지 처리

이전에는 오류 메시지를 FieldError를 생성할 때 하나하나 입력해주었는데 이러한 오류메시지도 서비스가 커지다보면 여러 곳에서 사용할 수 있고 이를 이전 포스트의 메시지 관리처럼 한곳에 모아 관리하면 유지보수가 편하다.

![](https://blog.kakaocdn.net/dn/mUDhO/btsv0p9YrhS/UfStp3qKzLG4jxYrYajqn0/img.png)

errors.properties 파일을 위와 같이 작성하고,

application.properties에 아래와 같이 작성한다.

```
spring.messages.basename=mesaages,errors
```

그리고 컨트롤러에서 FieldError를 생성할 때 codes와 args 매개변수를 사용해 이를 사용할 수 있다.

![](https://blog.kakaocdn.net/dn/k1uxE/btsv7dOJkna/DYMufOC6bih8TypiIlomH1/img.png)

### rejectValue(), reject() (v2)

FieldError, ObjectError는 다루기 좀 번거롭다는 생각이 들 수 있다.

컨트롤러에서 BindingResult는 검증해야 할 객체 바로 다음에 오기 때문에 이미 본인이 검증해야 할 객체인 target을 알고 있다.

BindingResult가 제공하는 rejectValue(), reject()를 사용하면 FieldError, ObjectError를 직접 생성하지 않고 깔끔하게 검증 오류를 다룰 수 있다.

![](https://blog.kakaocdn.net/dn/cIoMSA/btsvXQtvWxW/Y4VM0t4fG8qKp4kD4znfv0/img.png)
![](https://blog.kakaocdn.net/dn/b6JRMq/btsvYYEU8XA/elR6LLAZLQU6INZhEHckIK/img.png)

- field ("price") : 오류 필드 명
- errorCode ("range") : 오류 코드
	- messageResolver를 위한 코드
- errorArgs (new Object[]) : 오류 메시지에서 중괄호 값을 치환하기 위한 값.
- defaultMessage : 오류 메시지를 찾을 수 없을 때 사용하는 기본 메시지 


그런데 errorCode 부분에 "range" 라고 적었다.

> 실제 errors에서는 "range.item.price" 이다. 어떻게 가능할까?

이러한 부분을 이해하기 위해서는 MessageCodesResolver를 이해해야 한다.

오류 코드를 만들 때 range.item.price 와 같이 자세히 만들 수 있고 range=범위오류입니다. 이런식으로 간단히 만들 수도 있다.

단순하게 만들면 범용성이 좋아 여러 곳에서 사용할 수 있다. 하지만 메시지를 세밀하게 작성하기 어렵다. 반대로 너무 자세하게 만들면 범용성이 떨어진다.

가장 좋은 방법은 범용성으로 사용하다가, 세밀하게 작성해야 하는 경우 세밀한 내용이 적용되도록 메시지에 단계를 두는 방법이다.

> 예시

```
required=필수 값 입니다.
required.item.itemName=상품 이름은 필수 입니다.
```

처음에는 required로만 관리했었는데, 기획의 변경 등으로 상품 이름은 필수 입니다. 라고 바꾸어야 된다고 가정하자.

컨트롤러에는 이미 rejectValue("itemName", "required", null) 이런식으로 작성되어있다.

이럴 때 2번째 줄을 추가하게 되면 더 세부적인 부분이 우선시 되어 상품 이름은 필수 입니다. 가 되기 때문이다.

즉 객체명과 필드명을 조합한 세밀한 코드가 있으면 우선순위가 높은 것이다.

### MessageCodesResolver?

![](https://blog.kakaocdn.net/dn/XmtdK/btsvXUpmZWh/41HveHprP6wIpEOrygVuK1/img.png)

테스트코드를 통해 MessageCodesResolver에 대해 본다.

- 검증 오류 코드로 메시지 코드들을 생성한다.
- MessageCodesResolver 인터페이스이고 DefaultMessageCodesResolver는 기본 구현체이다.
- 주로 ObjectError, FieldError와 함께 사용한다.

> 기본 메시지 생성 규칙

```
//객체 오류의 경우
1.: code + "." + object name (required.item)
2.: code (required)

ex) 오류코드: required, object name: item

//필드 오류의 경우
1.: code + "." + object name + "." + field
2.: code + "." + field
3.: code + "." + field type
4.: code
```

> 동작 방식

- rejectValue(), reject()는 내부에서 MessageCodesResolver를 사용한다. 여기서 메시지 코드들을 생성한다.
- FieldError, ObjectError의 생성자를 보면 오류 코드를 하나가 아닌 여러개를 가질 수 있다. MessageCodesResolver를 통해 생성된 순서대로 오류 코드를 보관한다. (1번 발견하면 1번, 1번 발견 못하면 2번으로 넘어가는 방식)

이러한 과정 이후 타임리프 화면을 렌더링 할 때 th:errors가 실행될 때 오류가 있다면 생성된 오류 메시지 코드를 순서대로 돌아가며 메시지를 찾고 없을 때 디폴트 메시지를 출력하는 것이다.

### 스프링이 직접 만든 오류 메시지 처리

검증 오류 코드는 아래와 같은 2가지로 나눌 수 있다.

- 개발자가 직접 설정한 오류 코드 -> rejectValue()를 직접 호출
- 스프링이 직접 검증 오류에 추가한 경우 (주로 타입 정보 불일치)

price 필드에 문자를 입력해보자.

BindingResult에 FieldError가 담겨있고, 아래와 같은 메시지 코드들이 생성된다.

```
codes[typeMismatch.item.price, typeMismatch.price,
 typeMismatch.java.lang.Integer, typeMismatch]
```

스프링은 타입 오류가 발생하면 typeMismatch라는 오류 코드를 사용한다. 이 오류 코드가 MessageCodesResolver를 통하면서 4가지 메시지 코드가 생성된 것이다.

이대로 실행하면 스프링이 생성한 기본 메시지 (복잡한 메시지) 가 생성된다.

errors.properties에 아래와 같은 내용을 추가한다면?

```
typeMismatch.java.lang.Integer=숫자를 입력해주세요.
typeMismatch=타입 오류입니다.
```

소스코드를 하나도 건들지 않고 원하는 메시지를 단계별로 설정할 수 있다.
